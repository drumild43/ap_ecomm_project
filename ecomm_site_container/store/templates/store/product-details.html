{% extends "store/base.html" %}
{% load static %}
{% block content %}

    <section class="product-details">
      <div class="details container-md">
        <div class="left">
          <div class="main">
            <img src="./images/-rook.jpg" alt="">
          </div>
        </div>
        <div class="right">
          <h1>{{ product.name }}</h1>
          <h4>Rating: {{ product.get_avg_rating }} (based on {{ product.get_review_count }} reviews)</h4>
          <div class="price">
            {{ product.price }} 
          </div>
          <br/>

          {% if curr_user %}
          <form action="{% url 'store:add-to-cart' curr_user.id product.id %}" method="post">
            {% csrf_token %}
          {% else %}
          <form action="{% url 'store:product-signin-redirect' product.id %}" method="get">
          {% endif %}

            <select name="size" required>
              <option value="" selected disabled>Select Size</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
            </select>

            <select name="quantity" required>
              <option value="" selected disabled>Select Quantity</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>

            <button type="submit" name="update-method" value="add" style="margin: 0; border: 0px; font-size: 1.1rem;">
              Add to Cart
            </button>
          </form>

          {% if curr_user %}
          <form action="{% url 'store:update-wishlist' curr_user.id product.id %}" method="post">
            {% csrf_token %}
          {% else %}
          <form action="{% url 'store:product-signin-redirect' product.id %}" method="get">
          {% endif %}
            <button type="submit" name="update-method" value="add" style="margin: 0; border: 0px; font-size: 1.1rem;">
              Add to Wishlist 
              <div class="icons"><a><span><i class="bx bx-heart"></i></span></a></div>
            </button>
          </form>
          
          <h4>Product Details</h4>
          <h6>{{ product.description }}</h6>
            
            <div class="reviews">
              <ul>
                {% if curr_user %}
                <li>
                  <form action="{% url 'store:review' curr_user.id product.id %}" method="post">
                    <div class="review-container">
                      <select name="rating" required>
                        <option value="" selected disabled>Rating</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                      </select>

                      <textarea placeholder="Write Your review" name="review-text" rows="4" cols="50" required></textarea>
                      <p>Note: If you submit multiple reviews for a product, only your latest review will be valid.</p>
                      <button type="submit">Submit</button>
                    </div>
                  </form>
                </li>
                {% endif %}

                {% for review in product.review_set.all %}
                <li>
                  <div class="name">
                    <h4>{{ review.user.first_name }} {{ review.user.last_name }}</h4>
                  </div>

                  {% if review.is_by_verified_buyer %}
                  <button type="button">Verified Buyer</button>
                  {% endif %}

                  <div class="rating">
                  {% for i in "12345" %}
                    {% if forloop.counter > review.rating %}
                    <i class="bx bx-star fa-xs"></i>
                    {% else %}
                    <i class="bx bxs-star fa-xs"></i>
                    {% endif %}
                  {% endfor %}
                  </div>

                  <p>{{ review.review_text }}</p>
                </li>
                {% endfor %}

                {% if not curr_user %}
                <li><h4>Sign in to leave a review!</h4></li>
                {% endif %}
                
                
                
                <li>
                  <img src="./images/rw1.jpg">
                  <div class="name">
                    <h4>Meena Sehgal</h4>
                  </div>
                  <div class="rating">
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bx-star fa-xs"></i>
                    <i class="bx bx-star fa-xs"></i>
                  </div>
                </li>
                <li>
                  <img src="./images/rw2.jpg">
                  <div class="name">
                    <h4>Manisha Bagchi</h4>
                  </div>
                  <div class="rating">
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bxs-star fa-xs"></i>
                    <i class="bx bx-star fa-xs"></i>
                  </div>
                </li>

              </ul>
            </div>
        </div>
      </div>
    </section>
    
{% endblock content %}    